<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vajrayāna: An Interactive Journey</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Library for PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" xintegrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        .mountain-bg {
            background-image: linear-gradient(to top, #a1a1aa, #d4d4d8, #e5e7eb, #f9fafb, #ffffff);
        }
        .node {
            transition: all 0.3s ease-in-out;
            cursor: pointer;
        }
        .node:hover {
            transform: scale(1.1);
            filter: drop-shadow(0 10px 8px rgb(0 0 0 / 0.1)) drop-shadow(0 4px 3px rgb(0 0 0 / 0.1));
        }
        .node .label {
            transition: all 0.3s ease-in-out;
        }
        .node:hover .label {
            opacity: 1;
            transform: translateY(0);
        }
        .modal {
            transition: opacity 0.3s ease-in-out;
        }
        .modal-content {
            transition: transform 0.3s ease-in-out;
        }
        .path-line {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: draw-path 5s ease-in-out forwards;
        }
        @keyframes draw-path {
            to {
                stroke-dashoffset: 0;
            }
        }
        .pulsate {
            animation: pulsate 2s infinite;
        }
        @keyframes pulsate {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        .gemini-btn, #download-pdf-btn {
            transition: all 0.2s ease-in-out;
        }
        .gemini-btn:hover, #download-pdf-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-40 shadow-sm">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex justify-center items-center relative">
                <div class="text-center">
                    <h1 class="text-3xl md:text-4xl font-bold text-slate-900">Vajrayāna: The Culmination of the Path</h1>
                    <p class="mt-2 text-lg text-slate-600">An Interactive Journey with ✨ Gemini AI</p>
                </div>
                <button id="download-pdf-btn" class="absolute right-4 top-1/2 -translate-y-1/2 bg-green-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-green-700 transition-colors hidden md:block">Download as PDF</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
        <div class="bg-white rounded-2xl shadow-lg p-6 md:p-10 mountain-bg overflow-hidden">
            <div class="text-center mb-12">
                <h2 class="text-2xl font-bold text-slate-700">The Path to Enlightenment</h2>
                <p class="mt-2 text-slate-500 max-w-3xl mx-auto">This infographic visualizes the Vajrayāna path as an ascent. Click on each point to reveal key concepts and use the ✨ Gemini-powered features to deepen your understanding.</p>
            </div>

            <!-- The Mountain Path SVG -->
            <div class="relative w-full max-w-5xl mx-auto" style="height: 1200px;">
                <svg width="100%" height="100%" viewBox="0 0 800 1200" preserveAspectRatio="xMidYMid meet">
                    <!-- Path Line -->
                    <path d="M 400 1150 C 450 1000, 350 900, 400 800 C 450 700, 350 600, 400 500 C 450 400, 350 300, 400 200 C 450 150, 400 100, 400 50" stroke="#71717a" stroke-width="4" fill="none" class="path-line" stroke-linecap="round"/>
                    
                    <!-- Nodes on the path -->
                    <g class="node" onclick="showModal('foundation')"><circle cx="400" cy="1150" r="25" fill="#475569" /><text x="400" y="1155" font-size="20" fill="white" text-anchor="middle" class="font-bold">1</text><text x="400" y="1190" font-size="16" fill="#475569" text-anchor="middle" class="label font-semibold">The Foundation</text></g>
                    <g class="node" onclick="showModal('entering')"><circle cx="400" cy="800" r="25" fill="#64748b" /><text x="400" y="805" font-size="20" fill="white" text-anchor="middle" class="font-bold">2</text><text x="400" y="840" font-size="16" fill="#64748b" text-anchor="middle" class="label font-semibold">Entering the Path</text></g>
                    <g class="node" onclick="showModal('ascent')"><circle cx="400" cy="500" r="25" fill="#3b82f6" /><text x="400" y="505" font-size="20" fill="white" text-anchor="middle" class="font-bold">3</text><text x="400" y="540" font-size="16" fill="#3b82f6" text-anchor="middle" class="label font-semibold">The Ascent</text></g>
                    <g class="node" onclick="showModal('summit')"><circle cx="400" cy="200" r="25" fill="#8b5cf6" /><text x="400" y="205" font-size="20" fill="white" text-anchor="middle" class="font-bold">4</text><text x="400" y="240" font-size="16" fill="#8b5cf6" text-anchor="middle" class="label font-semibold">The Summit</text></g>
                    <g class="node pulsate" onclick="showModal('culmination')"><circle cx="400" cy="50" r="30" fill="#f59e0b" /><path d="M390,50 L400,35 L410,50 L400,65 Z" fill="white"/><text x="400" y="100" font-size="16" fill="#f59e0b" text-anchor="middle" class="label font-bold">The Culmination</text></g>
                </svg>
            </div>
        </div>
    </main>

    <!-- Modal Structure -->
    <div id="modal-container" class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 hidden opacity-0" onclick="hideModal()">
        <div id="modal-content" class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto p-6 md:p-8 transform scale-95" onclick="event.stopPropagation()">
            <!-- Content will be injected here by JS -->
        </div>
    </div>

<script>
    // --- DATA FOR MODALS ---
    const modalData = {
        foundation: {
            title: "1. The Foundation: Method & Wisdom",
            rawContent: `Vajrayāna is not a separate path but a specialized branch of Mahāyāna Buddhism. It requires a solid foundation in the core principles that are common to all Mahāyāna paths. The two core principles are Method (Bodhicitta, the aspiration to attain enlightenment for all beings) and Wisdom (the correct view of Emptiness, that all phenomena lack inherent existence). A practitioner needs both "wings" to fly to enlightenment.`,
            content: `
                <p class="mb-4">Vajrayāna is not a separate path but a specialized branch of Mahāyāna Buddhism. It requires a solid foundation in the core principles that are common to all Mahāyāna paths.</p>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg">
                        <h3 class="font-bold text-lg text-blue-800 flex items-center"><svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg>Method (Compassion)</h3>
                        <p class="mt-2 text-slate-700">This involves cultivating <strong>Bodhicitta</strong>: the profound aspiration to attain full enlightenment for the benefit of all sentient beings.</p>
                    </div>
                    <div class="bg-purple-50 border-l-4 border-purple-500 p-4 rounded-r-lg">
                        <h3 class="font-bold text-lg text-purple-800 flex items-center"><svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>Wisdom (Emptiness)</h3>
                        <p class="mt-2 text-slate-700">This is the correct view of <strong>Emptiness (Śūnyatā)</strong>: the understanding that all phenomena lack inherent, independent existence.</p>
                    </div>
                </div>
            `
        },
        entering: {
            title: "2. Entering the Path: Guru & Empowerment",
            rawContent: `The Vajrayāna path requires formal entry through a qualified Guru (spiritual mentor) and an Empowerment (Abhiṣeka) ritual. This ritual authorizes the student to engage in a specific tantric practice and comes with Commitments (Samaya), which are ethical restraints that protect the practitioner.`,
            content: `
                <p class="mb-4">The Vajrayāna path is not entered into lightly. It requires a formal entry through specific rituals and the guidance of a qualified teacher, ensuring the practitioner is a "suitable vessel."</p>
                <div class="space-y-4">
                    <div><h3 class="font-bold text-lg text-slate-800">The Guru (Spiritual Mentor)</h3><p class="mt-1 text-slate-700">A qualified Vajrayāna master is essential. They hold the lineage of the practice and guide the student.</p></div>
                    <div><h3 class="font-bold text-lg text-slate-800">Empowerment (Abhiṣeka)</h3><p class="mt-1 text-slate-700">This is the formal ritual that "empowers" or authorizes the student to engage in a specific tantric practice, planting the seeds for the realizations of the path.</p></div>
                    <div><h3 class="font-bold text-lg text-slate-800">Commitments (Samaya)</h3><p class="mt-1 text-slate-700">Receiving an empowerment comes with a pledge to uphold specific ethical restraints and practice commitments.</p></div>
                </div>
            `
        },
        ascent: {
            title: "3. The Ascent: The Four Classes of Tantra",
            rawContent: `Vajrayāna is structured in four progressive classes: Kriyā (Action) Tantra, which emphasizes external rituals. Caryā (Performance) Tantra, which balances external and internal practice. Yoga (Union) Tantra, which emphasizes internal yoga. Anuttarayoga (Highest Yoga) Tantra, the most profound class, with direct methods for achieving enlightenment quickly.`,
            content: `
                <p class="mb-4">Vajrayāna is structured in a progressive manner, with four classes or levels of practice. Each class has a different emphasis and method for uniting method and wisdom.</p>
                <ul class="space-y-3">
                    <li class="bg-gray-100 p-3 rounded-lg"><strong class="text-gray-800">Kriyā (Action) Tantra:</strong> Emphasizes external rituals and cleanliness.</li>
                    <li class="bg-blue-100 p-3 rounded-lg"><strong class="text-blue-800">Caryā (Performance) Tantra:</strong> Balances external ritual with internal meditation.</li>
                    <li class="bg-indigo-100 p-3 rounded-lg"><strong class="text-indigo-800">Yoga (Union) Tantra:</strong> Emphasizes internal yoga and meditation.</li>
                    <li class="bg-purple-100 p-3 rounded-lg"><strong class="text-purple-800">Anuttarayoga (Highest Yoga) Tantra:</strong> The most profound class, which contains the most direct methods for achieving enlightenment quickly.</li>
                </ul>
            `
        },
        summit: {
            title: "4. The Summit: Highest Yoga Tantra",
            rawContent: `Highest Yoga Tantra works directly with the subtle body (Channels, Winds, and Drops) to manifest the most fundamental level of consciousness. It has two stages: the Generation Stage, where one visualizes oneself as a deity to purify ordinary attachment, and the Completion Stage, where one works with the subtle energies to manifest the Fundamental Innate Mind of Clear Light.`,
            content: `
                <p class="mb-4">Highest Yoga Tantra is distinguished by its direct work with the subtle body and mind to manifest the most fundamental level of consciousness.</p>
                <div class="bg-slate-50 p-4 rounded-lg mb-6">
                    <h3 class="font-bold text-lg text-slate-800">The Subtle Body</h3>
                    <p class="mt-1 text-slate-700">A system of subtle energy consisting of: <strong>Channels (Nāḍī)</strong>, <strong>Winds/Energies (Prāṇa)</strong>, and <strong>Drops/Essences (Bindu)</strong>.</p>
                </div>
                <h3 class="font-bold text-lg text-slate-800 mb-2">The Two Stages of Practice:</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-r-lg">
                        <h4 class="font-semibold text-xl text-green-800">Generation Stage</h4>
                        <p class="mt-2 text-slate-700">The practitioner visualizes or "generates" themselves as a fully enlightened deity to purify attachment to the ordinary self.</p>
                    </div>
                    <div class="bg-violet-50 border-l-4 border-violet-500 p-4 rounded-r-lg">
                        <h4 class="font-semibold text-xl text-violet-800">Completion Stage</h4>
                        <p class="mt-2 text-slate-700">Through advanced yoga, the practitioner works with the subtle body to manifest the <strong>Fundamental Innate Mind of Clear Light</strong>.</p>
                    </div>
                </div>
            `
        },
        culmination: {
            title: "The Culmination: Union of Bliss & Emptiness",
            rawContent: `The ultimate point is to use the most subtle mind—the Clear Light, experienced as profound bliss—to realize the ultimate nature of reality—Emptiness. This non-dual wisdom is called Mahāmudrā (the Great Seal). Key realizations include the Illusory Body (a subtle body made of wind) and the Actual Clear Light, which lead to the final State of Union, or full enlightenment.`,
            content: `
                <p class="mb-4 text-lg">The ultimate point of the entire path is to use the most subtle and powerful state of mind—the Clear Light—to realize the ultimate nature of reality—Emptiness.</p>
                <div class="bg-amber-50 border-t-4 border-amber-400 p-6 rounded-b-lg text-center">
                    <h3 class="text-2xl font-bold text-amber-800">The Great Seal (Mahāmudrā)</h3>
                    <p class="mt-2 text-slate-700">This is the direct realization of the union of the <strong>Clear Light Mind</strong> (experienced as profound bliss) and its own ultimate nature, <strong>Emptiness</strong>.</p>
                </div>
                <div class="mt-6">
                    <h4 class="font-bold text-lg text-slate-800">Key Realizations on the Path:</h4>
                    <ul class="list-disc list-inside space-y-2 mt-2 text-slate-700">
                        <li><strong>Illusory Body:</strong> An actual subtle body, made of the most subtle winds, that the practitioner generates.</li>
                        <li><strong>Actual Clear Light:</strong> The direct, non-conceptual realization of emptiness by the most subtle mind.</li>
                        <li><strong>The State of Union:</strong> The final stage where the pure Illusory Body and the Actual Clear Light are unified, resulting in full enlightenment.</li>
                    </ul>
                </div>
                 <div class="mt-6 bg-slate-100 p-4 rounded-lg">
                    <h4 class="font-semibold text-slate-800">Final Advice from H.H. the Dalai Lama:</h4>
                    <p class="text-slate-600 italic">"The bodhicitta, this kind heart, is our gurus, our meditational deities, our ḍākinīs, and our protectors... If you consider yourself to be my friend, then I ask you, please, think about these teachings on compassion and wisdom."</p>
                </div>
            `
        }
    };

    const modalContainer = document.getElementById('modal-container');
    const modalContent = document.getElementById('modal-content');

    // --- GEMINI API LOGIC ---
    async function callGemini(prompt, targetElement) {
        targetElement.innerHTML = '<div class="loader"></div>';
        targetElement.classList.remove('hidden');
        let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
        const payload = { contents: chatHistory };
        const apiKey = "AIzaSyBv0x-3EdkidLIIhiZiZDCYCMIqPhGilXs";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
        let response;
        let retries = 0;
        const maxRetries = 5;
        while (retries < maxRetries) {
            try {
                response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (response.ok) {
                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        const formattedText = text.split('\n').map(p => `<p class="mb-2">${p}</p>`).join('');
                        targetElement.innerHTML = formattedText;
                        return;
                    }
                }
            } catch (error) {
                console.error("Fetch error:", error);
            }
            retries++;
            if (retries < maxRetries) {
                const delay = Math.pow(2, retries) * 1000 + Math.random() * 1000;
                await new Promise(resolve => setTimeout(resolve, delay));
            } else {
                targetElement.innerHTML = `<p class="text-red-500">Sorry, I couldn't get a response. Please try again later.</p>`;
            }
        }
    }

    // --- MODAL DISPLAY LOGIC ---
    function showModal(id) {
        const data = modalData[id];
        if (!data) return;
        modalContent.innerHTML = `
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl md:text-3xl font-bold text-slate-900">${data.title}</h2>
                <button onclick="hideModal()" class="text-slate-400 hover:text-slate-600 p-2 rounded-full transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="prose max-w-none">${data.content}</div>
            <div class="mt-8 border-t pt-6">
                <h3 class="text-lg font-semibold text-center text-slate-700 mb-4">Deepen Your Understanding with AI</h3>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button id="explain-btn" class="gemini-btn bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg shadow-md">✨ Explain Further</button>
                    <button id="meditate-btn" class="gemini-btn bg-purple-600 text-white font-semibold py-2 px-5 rounded-lg shadow-md">✨ Generate Guided Meditation</button>
                </div>
                <div id="gemini-output" class="mt-6 bg-slate-50 p-4 rounded-lg border hidden"></div>
            </div>
        `;
        modalContainer.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        setTimeout(() => {
            modalContainer.style.opacity = '1';
            modalContent.style.transform = 'scale(1)';
        }, 10);
        const explainBtn = document.getElementById('explain-btn');
        const meditateBtn = document.getElementById('meditate-btn');
        const geminiOutput = document.getElementById('gemini-output');
        explainBtn.addEventListener('click', () => {
            const prompt = `You are an AI assistant knowledgeable in Tibetan Buddhism. Please explain the following concept in a simple and accessible way for someone new to the topic. Focus on the core meaning and its practical relevance. Here is the concept: ${data.rawContent}`;
            callGemini(prompt, geminiOutput);
        });
        meditateBtn.addEventListener('click', () => {
            const prompt = `You are an AI assistant skilled in creating guided meditations. Based on the following Buddhist concept, please generate a short (approx. 150-200 words) guided meditation script. The script should be suitable for a beginner, with clear and simple instructions, starting with a settling-in phrase and ending with a gentle return to awareness. Here is the concept: ${data.rawContent}`;
            callGemini(prompt, geminiOutput);
        });
    }

    function hideModal() {
        modalContainer.style.opacity = '0';
        modalContent.style.transform = 'scale(0.95)';
        setTimeout(() => {
            modalContainer.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }, 300);
    }
    
    // --- PDF DOWNLOAD LOGIC ---
    function downloadAsPdf() {
        const originalHeader = document.querySelector('header');
        const originalMain = document.querySelector('main');

        // 1. Create a temporary printable container
        const printContainer = document.createElement('div');
        printContainer.style.width = '8.5in'; // Standard letter width
        printContainer.style.padding = '0.5in';
        printContainer.style.boxSizing = 'border-box';


        // 2. Clone the header and main content
        const headerClone = originalHeader.cloneNode(true);
        const mainClone = originalMain.cloneNode(true);
        
        // Remove the button from the cloned header
        const btnInClone = headerClone.querySelector('#download-pdf-btn');
        if(btnInClone) btnInClone.remove();

        printContainer.appendChild(headerClone);
        printContainer.appendChild(mainClone);

        // 3. Add a section for all modal content
        const modalContentSection = document.createElement('div');
        modalContentSection.innerHTML = '<h2 style="font-size: 24px; font-weight: bold; margin-top: 40px; text-align: center; page-break-before: always;">Detailed Explanations</h2>';
        
        for (const key in modalData) {
            const data = modalData[key];
            const section = document.createElement('div');
            section.style.pageBreakInside = 'avoid';
            section.style.marginTop = '20px';
            section.style.padding = '20px';
            section.style.border = '1px solid #e2e8f0';
            section.style.borderRadius = '8px';
            section.style.backgroundColor = '#f8fafc';

            section.innerHTML = `
                <h3 style="font-size: 20px; font-weight: bold; margin-bottom: 10px; color: #1e293b;">${data.title}</h3>
                <div style="color: #475569; font-size: 16px; line-height: 1.6;">${data.content}</div>
            `;
            modalContentSection.appendChild(section);
        }
        printContainer.appendChild(modalContentSection);

        // 4. Append the container off-screen to render it
        printContainer.style.position = 'absolute';
        printContainer.style.left = '-9999px';
        document.body.appendChild(printContainer);

        const opt = {
          margin:       0,
          filename:     'Vajrayana_Journey_Infographic.pdf',
          image:        { type: 'jpeg', quality: 0.98 },
          html2canvas:  { scale: 2, useCORS: true, letterRendering: true },
          jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
        };

        // 5. Generate PDF from the temporary container
        html2pdf().from(printContainer).set(opt).save().then(() => {
            document.body.removeChild(printContainer);
        }).catch(err => {
            console.error("PDF generation failed:", err);
            document.body.removeChild(printContainer);
        });
    }

    // --- EVENT LISTENERS ---
    document.addEventListener('DOMContentLoaded', () => {
        const btn = document.getElementById('download-pdf-btn');
        if (btn) {
            btn.addEventListener('click', downloadAsPdf);
        }
    });

    window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !modalContainer.classList.contains('hidden')) {
            hideModal();
        }
    });

</script>

</body>
</html>
